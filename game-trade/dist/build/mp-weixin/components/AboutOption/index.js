"use strict";var e=require("../../common/vendor.js");if(!Array){(e.resolveComponent("uni-dateformat")+e.resolveComponent("uni-icons")+e.resolveComponent("unicloud-db")+e.resolveComponent("uni-popup-dialog")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../node-modules/@dcloudio/uni-components/lib/unicloud-db/unicloud-db.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const o=e.defineComponent({__name:"index",props:{where:null,collection:null},setup(o){const n=o,t=e.ref(""),a=e.ref(),i=e.ref(),c=e.ref(""),u=e.ref(),l=e.rn.database(),r=e.ref(),s=async()=>{"takegood"==c.value?await l.collection("purchase").where(`_id=='${u.value}'`).update({state:2}).then((()=>{l.collection("purchase").where(`_id=='${r.value}'`).update({state:2})})):await l.collection("consignment").where(`_id=='${u.value}'`).update({state:1}),a.value.refresh()};e.onReachBottom((()=>{a.value.loadMore()}));const p=e.ref(),d=e.ref(""),m=e.ref("");return(v,b)=>({a:e.w((({data:n,loading:a,error:s},v,b)=>e.e({a:s},s?{b:e.t(s.message)}:{c:e.f(n,((n,a,s)=>e.e({a:e.o((o=>{return t=n._id,void e.index.navigateTo({url:`/pages/Detail/index?id=${t}`});var t})),b:n.screenshot[0].url,c:e.t(n.game),d:e.t(n.price.toFixed(2)),e:"ceb3b196-1-"+b+"-"+s+",ceb3b196-0",f:e.p({date:n.create_time,format:"yyyy-MM-dd hh:mm"}),g:0==n.state},0==n.state?{h:e.o((e=>{return o=n._id,a="type",c.value=a,u.value=o,t.value="你确定要下架商品吗",void i.value.open("center");var o,a})),i:"ceb3b196-2-"+b+"-"+s+",ceb3b196-0",j:e.p({type:"trash",size:"20"})}:{},{k:1==n.state},1==n.state?e.e({l:"consignment"==o.collection},(o.collection,{}),{m:"purchase"==o.collection},"purchase"==o.collection?{n:e.o((e=>((e,o)=>{r.value=e.consignment_id,c.value=o,u.value=e._id,t.value="你确定要确认收货吗",i.value.open("center")})(n,"takegood")))}:{}):{},{o:2==n.state},2==n.state?e.e({p:"consignment"==o.collection},(o.collection,{}),{q:"purchase"==o.collection},"purchase"==o.collection?{r:e.o((e=>(async e=>{await l.collection("consignment").where(`_id=='${e}'`).get().then((e=>{d.value=e.result.data[0].account,m.value=e.result.data[0].password})),p.value.open()})(n.consignment_id)))}:{}):{},{s:n._id})))},{d:a},{},{e:0==n.length},(n.length,{}),{f:b,g:v})),{name:"d",path:"a",vueId:"ceb3b196-0"}),b:e.sr(a,"ceb3b196-0",{k:"udb"}),c:e.p({collection:o.collection,orderby:"create_time desc",field:"screenshot,_id,create_time,game,price,state,consignment_id",getone:!1,where:n.where,"page-size":4}),d:e.o(s),e:e.p({type:"warning",cancelText:"取消",confirmText:"确认",content:t.value}),f:e.sr(i,"ceb3b196-3",{k:"soldOut"}),g:e.p({type:"dialog"}),h:e.t(d.value),i:e.t(m.value),j:e.sr(p,"ceb3b196-5",{k:"popup"}),k:e.p({type:"center"})})}});var n=e._export_sfc(o,[["__scopeId","data-v-ceb3b196"]]);wx.createComponent(n);
