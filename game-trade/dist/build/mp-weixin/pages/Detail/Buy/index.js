"use strict";var e=require("../../../common/vendor.js"),n=require("../../../store/index.js");if(require("../../../store/user.js"),require("../../../store/LeagueofLegend.js"),require("../../../store/GenshinImpact.js"),require("../../../store/GloryOfTheKing.js"),require("../../../store/detail.js"),!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-popup"))()}const o=()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js",a=()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||(e.unref(t)+o+e.unref(s)+a)();const t=()=>"../../../components/Basic/index.js",s=()=>"../../../components/Button/index.js",u=e.defineComponent({__name:"index",setup(o){e.useCssVars((e=>({"64acfbc4":c.value})));const a=n.useStore(),{balance:t}=e.storeToRefs(a.user),s=e.ref(),u=e.rn.database(),i=e.ref(!1),r=e.ref(),c=e.ref(),l=()=>{i.value=!i.value,i.value?(c.value="#5869ee",s.value.price*=1.2):(c.value="",s.value.price=r.value)};e.onLoad((async e=>{var n;e.id&&await u.collection("consignment").where(`_id=='${e.id}'`).get({getOne:!0}).then((e=>{s.value=e.result.data})),r.value=null==(n=s.value)?void 0:n.price}));const d=e.ref(null),p=()=>{d.value.open()},v=e.ref([{value:0,text:"钱包余额",icon:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-bbcb161c-b876-49e7-9693-67e4dd086408/4073f69a-c176-4a41-a20b-65804227efba.png"},{value:1,text:"微信",icon:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-bbcb161c-b876-49e7-9693-67e4dd086408/58c510c2-bf12-443f-b2d0-cd6127496ea1.png"},{value:2,text:"支付宝",icon:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-bbcb161c-b876-49e7-9693-67e4dd086408/05e0800e-9908-46c1-a146-2d1151f0bd6b.png"}]),b=e.ref("钱包余额"),f=()=>{d.value.close()},m=async()=>{var n,o,a,i,r;t.value<s.value.price?e.index.showToast({title:"您的余额不足",icon:"error"}):(u.collection("balance").add({money:-s.value.price}),u.collection("consignment").where(`_id=='${null==(n=s.value)?void 0:n._id}'`).update({state:2}),await u.collection("purchase").add({consignment_id:null==(o=s.value)?void 0:o._id,state:1,game:null==(a=s.value)?void 0:a.game,screenshot:null==(i=s.value)?void 0:i.screenshot,price:null==(r=s.value)?void 0:r.price}),e.index.switchTab({url:"/pages/Mine/index",success(){e.index.showToast({title:"您已经成功购买!"})}}))};return(n,o)=>{var a,u;return e.e({a:e.p({detail:s.value}),b:i.value},(i.value,{}),{c:e.o(l),d:e.s(n.__cssVars()),e:e.t(null==(a=s.value)?void 0:a.price.toFixed(2)),f:e.o(p),g:e.s(n.__cssVars()),h:e.o(f),i:e.p({type:"arrow-left",size:"30",color:"#5869ee"}),j:e.t(null==(u=s.value)?void 0:u.price.toFixed(2)),k:e.f(v.value,((n,o,a)=>e.e({a:n.icon,b:e.t(n.text),c:"钱包余额"==n.text},"钱包余额"==n.text?{d:e.t(e.unref(t).toFixed(2))}:{},{e:e.o((e=>{return o=n.value,void(b.value=v.value[o].text);var o})),f:b.value==n.text?"#5869ee":"",g:n.value}))),l:e.o(m),m:e.p({title:"立即支付"}),n:e.sr(d,"0d4410fc-1",{k:"order"}),o:e.s(n.__cssVars()),p:e.p({type:"bottom",safeArea:!1})})}}});var i=e._export_sfc(u,[["__scopeId","data-v-0d4410fc"]]);wx.createPage(i);
